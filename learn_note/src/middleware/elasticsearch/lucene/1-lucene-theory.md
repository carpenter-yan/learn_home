##原理

参考资料
[lucene原理及java实现【容易理解】](https://blog.csdn.net/liuhaiabc/article/details/52346493)

###一、Lucene是什么？
1. Lucene是一个高效的，基于Java的全文检索库。 
结构化数据： 指具有固定格式或有限长度的数据，如数据库，元数据等。
非结构化数据： 指不定长或无固定格式的数据，如邮件，word文档等。

按照数据的分类，搜索也分为两种：
对结构化数据的搜索 ：如对数据库的搜索，用SQL语句。再如对元数据的搜索，如利用windows搜索对文件名，类型，修改时间进行搜索等。
对非结构化数据的搜索 ：如利用windows的搜索也可以搜索文件内容，Linux下的grep命令，再如用Google和百度可以搜索大量内容数据。

对非结构化数据也即对全文数据的搜索主要有两种方法：
一种是顺序扫描法：所谓顺序扫描，比如要找内容包含某一个字符串的文件，就是一个文档一个文档的看，对于每一个文档，从头看到尾，
如果此文档包含此字符串，则此文档为我们要找的文件，接着看下一个文件，直到扫描完所有的文件。如利用windows的搜索也可以搜索文件内容，
只是相当的慢。

将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对此有一定结构的数据进行搜索，从而达到搜索相对较快的目的。
这部分从非结构化数据中提取出的然后重新组织的信息，我们称之索引。比如字典中的拼音和部首查字法

这种先建立索引，再对索引进行搜索的过程就叫全文检索

全文检索大体分两个过程，索引创建(Indexing)和搜索索引(Search)。
索引创建：将现实世界中所有的结构化和非结构化数据提取信息，创建索引的过程。
搜索索引：就是得到用户的查询请求，搜索创建的索引，然后返回结果的过程。
于是全文检索就存在三个重要问题：
1.索引里面究竟存些什么？(Index)
2.如何创建索引？(Indexing)
3.如何对索引进行搜索？(Search)

### 二、索引里面究竟存些什么
字符串到文件的映射是文件到字符串映射的反向过程，于是保存这种信息的索引称为反向索引。
反向索引的所保存的信息一般如下：
左边保存的是一系列字符串，称为词典。
每个字符串都指向包含此字符串的文档(Document)链表，此文档链表称为倒排表 (Posting List)。
有了索引，便使保存的信息和要搜索的信息一致，可以大大加快搜索的速度。

全文检索的确加快了搜索的速度，但是多了索引的过程，两者加起来不一定比顺序扫描快多少。
的确，加上索引的过程，全文检索不一定比顺序扫描快，尤其是在数据量小的时候更是如此。
而对一个很大量的数据创建索引也是一个很慢的过程。
然而两者还是有区别的，顺序扫描是每次都要扫描，而创建索引的过程仅仅需要一次，以后便是一劳永逸的了，
每次搜索，创建索引的过程不必经过，仅仅搜索创建好的索引就可以了。
这也是全文搜索相对于顺序扫描的优势之一：一次索引，多次使用。

### 三、如何创建索引
* 第一步：一些要索引的原文档(Document)。
* 第二步：将原文档传给分词器(Tokenizer)。
  分词器(Tokenizer)会做以下几件事情( 此过程称为Tokenize) ：
    1. 将文档分成一个一个单独的单词。
    2. 去除标点符号。
    3. 去除停词(Stop word)
  经过分词(Tokenizer) 后得到的结果称为词元(Token) 。
* 第三步：将得到的词元(Token)传给语言处理组件(Linguistic Processor)。
  语言处理组件(linguistic processor)主要是对得到的词元(Token)做一些同语言相关的处理。
    对于英语，语言处理组件(Linguistic Processor)一般做以下几点：
    1.变为小写(Lowercase)。
    2.将单词缩减为词根形式，如“cars”到“car”等。这种操作称为：stemming。
    3.将单词转变为词根形式，如“drove”到“drive”等。这种操作称为：lemmatization。
* 第四步：将得到的词(Term)传给索引组件(Indexer)。
  索引组件(Indexer)主要做以下几件事情：
    1. 利用得到的词(Term)创建一个字典。
    2. 对字典按字母顺序进行排序。
    3. 合并相同的词(Term) 成为文档倒排(Posting List) 链表。 
  在此表中，有几个定义：
    Document Frequency 即文档频次，表示总共有多少文件包含此词(Term)。
    Frequency 即词频率，表示此文件中包含了几个此词(Term)。

### 四、如何对索引进行搜索？
* 第一步：用户输入查询语句。
* 第二步：对查询语句进行词法分析，语法分析，及语言处理。
  1. 词法分析主要用来识别单词和关键字。
  2. 语法分析主要是根据查询语句的语法规则来形成一棵语法树。
  3. 语言处理同索引过程中的语言处理几乎相同。
* 第三步：搜索索引，得到符合语法树的文档。
  此步骤有分几小步：
  首先，在反向索引表中，分别找出包含lucene，learn，hadoop的文档链表。
  其次，对包含lucene，learn的链表进行合并操作，得到既包含lucene又包含learn的文档链表。
  然后，将此链表与hadoop的文档链表进行差操作，去除包含hadoop的文档，从而得到既包含lucene又包含learn而且不包含hadoop的文档链表。
  此文档链表就是我们要找的文档。
* 第四步：根据得到的文档和查询语句的相关性，对结果进行排序。
  1. 计算权重(Term weight)的过程。
  2. 判断Term之间的关系从而得到文档相关性的过程，也即向量空间模型的算法(VSM)。

1. 索引过程：
1)有一系列被索引文件
2)被索引文件经过语法分析和语言处理形成一系列词(Term)。
3)经过索引创建形成词典和反向索引表。
4)通过索引存储将索引写入硬盘。
2. 搜索过程：
a)用户输入查询语句。
b)对查询语句经过语法分析和语言分析得到一系列词(Term)。
c)通过语法分析得到一个查询树。
d)通过索引存储将索引读入到内存。
e)利用查询树搜索索引，从而得到每个词(Term)的文档链表，对文档链表进行交，差，并得到结果文档。
f)将搜索到的结果文档对查询的相关性进行排序。
g)返回查询结果给用户。


##实践

参考资料
[Lucene介绍与使用](https://blog.csdn.net/weixin_42633131/article/details/82873731?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control&dist_request_id=&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control)

match查询
如果你在一个全文字段上使用match查询，在执行查询前，它将用正确的分析器去分析查询字符串：
如果在一个精确值的字段上使用它，例如数字、日期、布尔或者一个not_analyzed 字符串字段，那么它将会精确匹配给定的值：
对于精确值的查询，你可能需要使用filter语句来取代query，因为filter将会被缓存。接下来，我们将看到一些关于filter的例子。